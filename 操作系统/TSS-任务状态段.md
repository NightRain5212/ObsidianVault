
- TSS是用于存储任务状态的一个数据结构，每个任务都有自己的 TSS。
- 32位：这个数据结构包含了**在任务切换时需要保存和恢复的信息**，例如处理器寄存器的值、堆栈指针、页目录基地址寄存器的值等，它放在内存的一块连续区域中。
- **64位**：TSS **不再**保存任务的上下文（寄存器），它变成了一个**存放“特殊栈指针”的仓库**。它最主要的作用就是告诉 CPU：**“如果有用户态程序想进内核，请把它的栈切换到这里（RSP0）。”**
- TSS 是硬件级别**任务切换机制**的一部分。

# 提供内核栈实现状态切换

- 当一个用户程序（运行在 Ring 3，使用用户栈）执行系统调用（`int 0x80`）或被时钟中断打断时，CPU 需要立即提升权限到 Ring 0 来运行内核代码。
    
- 内核代码必须在安全的**内核栈**上运行，不能继续使用不可信的用户栈。CPU 怎么知道内核栈在哪？
- **机制**：CPU 硬件会自动读取当前 TSS 中的 **`RSP0`** 字段，将其值加载到 `RSP` 寄存器中，从而完成栈的切换。

# 防止死循环崩溃：IST (中断栈表)

- IST是一个包含 7 个栈指针的数组 (`ist[0]` - `ist[6]`)。
- 用于为特定的、严重的中断（如 Double Fault 双重错误、NMI 不可屏蔽中断）指定**专用**的栈，防止因为内核栈本身溢出或损坏导致系统彻底崩溃。
- 而 TSS 中就存在 IST 的指针


