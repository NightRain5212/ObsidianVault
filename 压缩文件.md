
## 压缩文件分区
	
- **归档头部 (Archive Header)**：文件的“魔法签名”，用来识别这是我们的归档文件，并包含总体信息。
	- 一个独特的**标识符** (Magic Number)，比如 `MZIP` (4字节)。
	- **文件中包含的文件数量** (Number of Files)，比如一个 `uint64_t` (8字节)。

- **文件元数据区 (File Metadata Block)**：这是一个连续的区域，像一本书的目录，按顺序列出每个文件的信息。每个文件对应一条元数据记录。
	- **文件名 (File Name)**：用于恢复文件名。
	- **原始文件大小 (Original Size)**：解压时需要。
	- **压缩后数据大小 (Compressed Size)**：解压时需要知道该读取多少压缩数据。

- **数据区 (Data Blocks)**：连续存放每个文件压缩后的二进制数据。

```
+---------------------------------------+ 
| 归档头部 (Header)                     |
| - "MZIP" (Magic Number)               | 
| - 3 (文件总数)                        | 
+---------------------------------------+ 
| 文件元数据区 (Metadata)               | 
| [文件名:"a.txt", 原始:102B, 压缩:50B] |
| [文件名:"b.log", 原始:250B, 压缩:112B]| 
| [文件名:"c.dat", 原始:88B, 压缩:45B]  | 
+---------------------------------------+ 
| 数据区 (Data Blocks)                  | 
| +-------------------------------+     | 
| a.txt 的压缩数据 (50B)            |   |
| +-------------------------------+ |   |
| b.log 的压缩数据 (112B)           |   | 
| +-------------------------------+ |   |
| c.dat 的压缩数据 (45B)            |   |
| +-------------------------------+     |
+---------------------------------------+
```

- 简化分区：

1. **归档头部**：
    - 文件标识
    - 文件总数
2. **元数据区**：
    - 文件记录列表，每条记录只包含：**文件名** 和 **原始大小**。
3. **单一、连续的数据块**：
    - 这是 `文件1内容 + 文件2内容 + ...` 经过统一压缩后的结果。

```
+---------------------------------------+ 
| 归档头部 (Header)                     |
| - "MZIP" (Magic Number)               | 
| - 3 (文件总数)                        | 
+---------------------------------------+ 
| 文件元数据区 (Metadata)               | 
| [文件名:"a.txt", 原始:102B]           |
| [文件名:"b.log", 原始:250B]           | 
| [文件名:"c.dat", 原始:88B]            | 
+---------------------------------------+ 
| 数据区 (Data Blocks)                  | 
|                                       | 
| a.txt 的压缩数据                  |   |
|                                   |   |
| b.log 的压缩数据                  |   | 
|                                   |   |
| c.dat 的压缩数据                  |   |
|                                       |
+---------------------------------------+
```


## 压缩流程

- **收集输入**：获取所有要压缩的文件路径列表。
- **打开归档文件**：创建一个新的 `.mzip` 文件用于写入。
- **占位**：在文件开头，根据文件数量，先写入一块“占位符”区域。这块区域将来用于存放归档头部和所有文件的元数据。我们需要预先计算它的大小 (`sizeof(Magic) + sizeof(NumFiles) + NumFiles * sizeof(FileMetadata)`)。
- **逐个压缩**：将该文件的压缩数据**直接写入**到占位符区域**之后**的位置，在压缩过程中，记录下它的**原始大小**和**压缩后的大小**，并保存在内存中的一个元数据列表里。
- **回填元数据**：所有文件都压缩完毕后，我们已经收集了所有元数据。将文件写入指针**移回到文件开头**。现在，将最终的归档头部（"MZIP"和文件数）和内存中完整的元数据列表**写入**到之前预留的占位符区域。

## 解压流程

- **打开归档文件**：打开 `.mzip` 文件用于读取。
- **读取头部**：读取“MZIP”标识符进行验证，然后读取文件数量。
- **读取元数据**：根据文件数量，一次性读取整个文件元数据区，存入内存中的`std::vector<FileMetadata>`。
- **逐个解压**：此时，文件读取指针正好位于第一个文件的数据块开头。遍历元数据列表中的每一条记录。根据记录中的`文件名`创建新的输出文件。调用解压逻辑，告诉它需要从归档文件中解压，并且当解压出的字节数达到`原始大小`时停止。因为我们知道每个文件的`压缩后大小`，所以可以确保解压每个文件时不会错误地多读数据。

